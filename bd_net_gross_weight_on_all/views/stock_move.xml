<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <record id="view_picking_form_inherit_weight" model="ir.ui.view">
        <field name="name">stock.picking.form.inherit.weight</field>
        <field name="model">stock.picking</field>
        <field name="inherit_id" ref="stock.view_picking_form" />
        <field name="arch" type="xml">
            
            <!-- Add below the 'note' field or where it fits best -->
            <xpath expr="//group[@name='other_infos']" position="after">
                <group string="Weight Details" groups="bd_net_gross_weight_on_all.group_net_gross_weight_delivery">
                    <field name="display_weight"/>
                    <field name="display_weight_subtotel"/>
                    <field name="total_net_weight" readonly="1"/>
                    <field name="total_gross_weight" readonly="1"/>
                </group>
            </xpath>

            <xpath expr="//notebook//page[@name='operations']//field//list//field[@name='product_uom_qty']" position="after">
                <field name="net_weight" readonly="1" groups="bd_net_gross_weight_on_all.group_net_gross_weight_delivery"/>
                <field name="gross_weight" readonly="1" groups="bd_net_gross_weight_on_all.group_net_gross_weight_delivery"/>
            </xpath>

        </field>
    </record>


    <template id="report_delivery_document_inherit_weight" inherit_id="stock.report_delivery_document">
        <xpath expr="//table[@name='stock_move_table']" position="replace">
            <table class="table table-sm table-borderless" t-if="o.state!='done'" name="stock_move_table">
                <thead>
                    <tr>
                        <th name="th_sm_product"><strong>Product</strong></th>
                        <th name="th_sm_ordered" class="text-end"><strong>Ordered</strong></th>
                        <th name="th_sm_quantity" class="text-end"><strong>Delivered</strong></th>
                        <t t-if="o.display_weight">
                            <th name="th_net_weight" class="text-end"><strong>Net Weight</strong></th>
                            <th name="th_gross_weight" class="text-end"><strong>Gross Weight</strong></th>
                        </t>
                    </tr>
                </thead>
                <tbody>
                    <t t-set="lines" t-value="o.move_ids.filtered(lambda x: x.product_uom_qty)"/>
                    <tr t-foreach="lines" t-as="move">
                        <td>
                            <span t-field="move.product_id">Customizable Desk</span>
                            <p t-if="move.description_picking and move.description_picking != move.product_id.name and move.description_picking != move.product_id.display_name">
                                <span t-out="move.description_picking" t-options="{'widget': 'text'}">Description on transfer</span>
                            </p>
                        </td>
                        <td class="o_td_quantity text-end">
                            <span t-out="format_number(move.product_uom_qty)" class="text-nowrap">3.00</span>
                            <span t-field="move.product_uom" groups="uom.group_uom">units</span>
                            <t t-if="move.packaging_uom_id != move.product_uom" groups="uom.group_uom">
                                <br/>
                                <span class="text-muted" t-field="move.packaging_uom_qty">1.00</span>
                                <span class="text-muted" t-field="move.packaging_uom_id">Pack of 6</span>
                            </t>
                        </td>
                        <td class="o_td_quantity text-end">
                            <span t-out="format_number(move.quantity)" class="text-nowrap">3.00</span>
                            <span t-field="move.product_uom" groups="uom.group_uom">units</span>
                            <t t-if="move.packaging_uom_id != move.product_uom" groups="uom.group_uom">
                                <br/>
                                <span class="text-muted" t-esc="move.product_uom._compute_quantity(move.quantity, move.packaging_uom_id)">1.00</span>
                                <span class="text-muted" t-field="move.packaging_uom_id">Pack of 6</span>
                            </t>
                        </td>
                        <t t-if="o.display_weight">
                            <td class="o_td_quantity text-end">
                                <span t-field="move.net_weight" class="text-nowrap"></span>
                            </td>
                            <td class="o_td_quantity text-end">
                                <span t-field="move.gross_weight" class="text-nowrap"></span>
                            </td>
                        </t>
                    </tr>
                </tbody>
            </table>
        </xpath>


        <xpath expr="//th[@name='th_sml_quantity']" position="after">
            <t t-if="o.display_weight">
                <th name="th_net_weight" class="text-end"><strong>Net Weight</strong></th>
                <th name="th_gross_weight" class="text-end"><strong>Gross Weight</strong></th>
            </t>
        </xpath>

        <xpath expr="//div[@t-if='not o.signature']" position="before">
            <t t-if="o.display_weight_subtotel">
                <table class="o_total_table table table-borderless">
                    <tr>
                        <td colspan="5"/>
                        <td class="text-end"><strong>Total Net Weight:</strong></td>
                        <td class="text-end">
                            <t t-esc="sum(o.move_ids.mapped('total_net_weight'))"/>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="5"/>
                        <td class="text-end"><strong>Total Gross Weight:</strong></td>
                        <td class="text-end">
                            <t t-esc="sum(o.move_ids.mapped('total_gross_weight'))"/>
                        </td>
                    </tr>
                </table>
            </t>
        </xpath>
    </template>

    <template id="report_stock_report_delivery_aggregated_move_lines_inherit_weight" inherit_id="stock.stock_report_delivery_aggregated_move_lines">
        <xpath expr="//td[@name='move_line_aggregated_quantity']" position="after">
            <t t-if="o.display_weight">
                <td class="text-end"><span t-out="aggregated_lines[line]['product'].net_weight" /></td>
                <td class="text-end"><span t-out="aggregated_lines[line]['product'].gross_weight" /></td>
            </t>
        </xpath>
    </template>

    <record id="action_stock_move_view_order_form_net_gross" model="ir.actions.server">
        <field name="name">Bulk Display weight report</field>
        <field name="model_id" ref="stock.model_stock_picking"/>
        <field name="binding_model_id" ref="stock.model_stock_picking"/>
        <field name="state">code</field>
        <field name="code">
            records.action_black_net()
        </field>
    </record>

    <record id="action_stock_move_view_order_form_gross_net" model="ir.actions.server">
        <field name="name">Bulk Display weight column Subtotal</field>
        <field name="model_id" ref="stock.model_stock_picking"/>
        <field name="binding_model_id" ref="stock.model_stock_picking"/>
        <field name="state">code</field>
        <field name="code">
            records.action_black_gross()
        </field>
    </record>
</odoo>
